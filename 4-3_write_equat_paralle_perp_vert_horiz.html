<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>Advanced Linear Equation Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for correct/incorrect feedback */
        .correct-answer {
            border: 2px solid #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .incorrect-answer {
            border: 2px solid #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
        .correct-text {
            color: #166534; /* green-800 */
            font-weight: 600;
        }
        .incorrect-text {
            color: #991b1b; /* red-800 */
            font-weight: 600;
        }
        /* Style for the math display */
        .math-display {
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.5rem; /* 24px */
            color: #1e3a8a; /* blue-800 */
            display: inline-block;
            margin: 0 0.25rem;
            font-weight: bold;
        }
        /* Style for the answer input boxes */
        .answer-input {
            width: 6rem; /* 96px */
            padding: 0.5rem;
            border: 2px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            text-align: center;
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.5rem; /* 24px */
            font-weight: bold;
        }
        /* New style for the full equation input */
        .equation-input {
            width: 12rem; /* 192px */
            padding: 0.5rem;
            border: 2px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            text-align: center;
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.5rem; /* 24px */
            font-weight: bold;
        }
        .equation-input:focus {
            outline: none;
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.4);
        }
        .equation-input:disabled {
            background-color: #f3f4f6; /* gray-100 */
            color: #4b5563; /* gray-600 */
            cursor: not-allowed;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="max-w-lg w-full">
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center">Advanced Linear Practice</h1>
            <p class="text-lg text-gray-600 text-center mt-2">Standard Form & Point-Slope</p>
            <div id="game-stats" class="text-2xl font-bold text-center mt-4 text-gray-700 flex justify-center gap-6">
                <div id="lives-counter" class="text-red-500">Lives: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div id="score-counter" class="text-blue-600">Score: 0</div>
            </div>
        </header>

        <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl">
            <div id="quiz-area" class="space-y-6">
                
                <div class="text-center min-h-[120px] flex flex-col justify-center">
                    <p class="text-lg text-gray-600">Problem:</p>
                    <div id="problem-statement" class="my-2 text-lg text-gray-800">
                        </div>
                </div>
                
                <div class="border-t border-gray-200 pt-6">
                    <p class="text-lg text-gray-600 text-center mb-4">Write the equation of the line:</p>
                    
                    <div id="slope-intercept-answer" class="hidden flex items-center justify-center space-x-2 text-3xl font-bold" style="font-family: 'Times New Roman', Times, serif;">
                        <span>y =</span>
                        <input type="text" id="m-input" class="answer-input" placeholder="e.g. -1/2">
                        <span>x +</span>
                        <input type="number" step="any" id="b-input" class="answer-input" placeholder="e.g. 3">
                    </div>

                    <div id="special-line-answer" class="hidden flex items-center justify-center space-x-2 text-3xl font-bold" style="font-family: 'Times New Roman', Times, serif;">
                        <input type="text" id="special-input" class="equation-input" placeholder="e.g. x=3">
                    </div>
                </div>

                <div id="feedback-area" class="">
                    </div>
            </div>

            <div class="mt-6 flex flex-col sm:flex-row gap-4">
                <button id="check-btn" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors shadow-md flex-1">
                    Check Answer
                </button>
                <button id="next-btn" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-green-700 transition-colors shadow-md flex-1 hidden">
                    Next Question
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const problemStatement = document.getElementById('problem-statement');
        const feedbackArea = document.getElementById('feedback-area');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const livesCounter = document.getElementById('lives-counter');
        const scoreCounter = document.getElementById('score-counter');
        
        // Answer Inputs
        const mInput = document.getElementById('m-input');
        const bInput = document.getElementById('b-input');
        const specialInput = document.getElementById('special-input');

        // Answer Format Divs
        const slopeInterceptAnswer = document.getElementById('slope-intercept-answer');
        const specialLineAnswer = document.getElementById('special-line-answer');

        // --- State Variables ---
        let currentQuestion = {};
        let currentSkill = -1; // Start at -1 to begin with skill 0
        let lives = 3;
        let score = 0;
        let isGameOver = false;
        let hasLostLifeThisQuestion = false;
        const FLOATING_POINT_TOLERANCE = 0.001;

        // --- Helper Functions ---
        function getRandomInt(min, max, exclude = []) {
            let num;
            do {
                num = Math.floor(Math.random() * (max - min + 1)) + min;
            } while (exclude.includes(num));
            return num;
        }

        // GCD for simplifying fractions
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        function simplifyFraction(numerator, denominator) {
            const divisor = Math.abs(gcd(numerator, denominator));
            return {
                n: numerator / divisor,
                d: denominator / divisor
            };
        }

        function parseFraction(str) {
            if (typeof str !== 'string' || !str) return NaN;
            str = str.trim();
            if (!str.includes('/')) return parseFloat(str);
            const parts = str.split('/');
            if (parts.length !== 2) return NaN;
            const num = parseFloat(parts[0]);
            const den = parseFloat(parts[1]);
            if (isNaN(num) || isNaN(den) || den === 0) return NaN;
            return num / den;
        }

        function formatStandardForm(A, B, C) {
            // Ax + By = C
            let aStr = '';
            if (A === 1) aStr = 'x';
            else if (A === -1) aStr = '-x';
            else if (A !== 0) aStr = `${A}x`;

            let bStr = '';
            if (B === 1) bStr = A !== 0 ? ' + y' : 'y';
            else if (B === -1) bStr = ' - y';
            else if (B > 0) bStr = A !== 0 ? ` + ${B}y` : `${B}y`;
            else if (B < 0) bStr = ` - ${Math.abs(B)}y`;

            return `<strong class="math-display">${aStr}${bStr} = ${C}</strong>`;
        }

        function formatSlopeIntercept(m, b) {
            // Handling fractions for display if needed, but simple m/b is okay for feedback
            let mStr = (m === 1) ? 'x' : (m === -1) ? '-x' : `${m}x`;
            let bStr = (b === 0) ? '' : (b > 0) ? ` + ${b}` : ` - ${Math.abs(b)}`;
            return `<strong class="math-display">y = ${mStr}${bStr}</strong>`;
        }
        
        // Helper to format signs for Point Slope Feedback: (x - x1)
        function formatPointParen(val) {
            return val < 0 ? `(${val})` : `${val}`;
        }
        
        function formatPointSlopeTerm(val) {
             return val < 0 ? `+ ${Math.abs(val)}` : `- ${val}`;
        }

        function updateStatsDisplay() {
            livesCounter.innerHTML = `Lives: ${'‚ù§Ô∏è'.repeat(lives)}${'üñ§'.repeat(3 - lives)}`;
            scoreCounter.innerHTML = `Score: ${score}`;
        }

        // --- Question Generation Logic ---
        function generateQuestion() {
            if (isGameOver) return;

            // Reset UI
            mInput.value = ''; bInput.value = ''; specialInput.value = '';
            feedbackArea.innerHTML = '';
            [mInput, bInput, specialInput].forEach(el => {
                el.classList.remove('correct-answer', 'incorrect-answer');
                el.disabled = false;
            });

            slopeInterceptAnswer.classList.add('hidden');
            specialLineAnswer.classList.add('hidden');
            
            checkBtn.disabled = false;
            checkBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            hasLostLifeThisQuestion = false;
            
            // Cycle skills: 0=Parallel(Std), 1=Perp(Std), 2=Special Lines
            currentSkill = (currentSkill + 1) % 3;
            currentQuestion = { skillType: currentSkill };
            problemStatement.innerHTML = '';

            let A, B, C, m_given, m_correct, x1, y1, b_correct;

            if (currentSkill === 0 || currentSkill === 1) { // Standard Form Parallel/Perp
                // 1. Generate a nice slope first
                let num = getRandomInt(1, 4) * (Math.random() < 0.5 ? 1 : -1);
                let den = getRandomInt(1, 3);
                m_given = num / den; // The slope of the given line

                // 2. Convert slope to A and B for Ax + By = C
                // m = -A/B.  If m = 2/3, -A/B = 2/3 -> A=-2, B=3 OR A=2, B=-3
                // We want standard form A > 0 usually, but let's just make sure they are integers.
                // simplify fraction first
                let frac = simplifyFraction(num, den);
                // m = n/d.  -A/B = n/d.  Let A = n, B = -d.
                A = frac.n;
                B = -frac.d;
                
                // Randomize signs to vary appearance, keep equality valid
                if (Math.random() < 0.5) { A = -A; B = -B; }
                
                C = getRandomInt(-20, 20); // The C constant for the given line

                // 3. Generate the point (x1, y1)
                x1 = getRandomInt(-10, 10);
                y1 = getRandomInt(-10, 10);

                // Calculate Correct M
                if (currentSkill === 0) { // Parallel
                    m_correct = m_given;
                } else { // Perpendicular
                     m_correct = -1 / m_given;
                }

                // Calculate Correct B
                b_correct = y1 - m_correct * x1;

                currentQuestion = {
                    skillType: currentSkill,
                    A, B, C, x1, y1, m_given, m_correct, b_correct
                };

                const type = currentSkill === 0 ? "parallel" : "perpendicular";
                problemStatement.innerHTML = `
                    <p>Find the equation of a line that is <strong>${type}</strong> to:</p>
                    ${formatStandardForm(A, B, C)}
                    <p class="mt-2">and passes through <strong class="math-display">(${x1}, ${y1})</strong>.</p>
                `;
                slopeInterceptAnswer.classList.remove('hidden');
                mInput.focus();

            } else { // Special Lines (Vertical/Horizontal mixed)
                // Randomly decide: Parallel or Perpendicular
                const isParallel = Math.random() < 0.5;
                // Randomly decide: Given line is Vertical (x=c) or Horizontal (y=c)
                const isGivenVertical = Math.random() < 0.5; 
                
                const givenVal = getRandomInt(-9, 9);
                x1 = getRandomInt(-10, 10);
                y1 = getRandomInt(-10, 10);

                let targetType = ''; // 'x=' or 'y='
                let targetVal = 0;

                // Logic Matrix:
                // Given Vertical (x=c) + Parallel -> Result Vertical (x = x1)
                // Given Vertical (x=c) + Perp     -> Result Horizontal (y = y1)
                // Given Horiz (y=c)    + Parallel -> Result Horizontal (y = y1)
                // Given Horiz (y=c)    + Perp     -> Result Vertical (x = x1)

                if (isGivenVertical) {
                    if (isParallel) { targetType = 'x'; targetVal = x1; } 
                    else { targetType = 'y'; targetVal = y1; }
                } else { // Given Horizontal
                    if (isParallel) { targetType = 'y'; targetVal = y1; }
                    else { targetType = 'x'; targetVal = x1; }
                }

                currentQuestion = {
                    skillType: 2,
                    isParallel,
                    isGivenVertical,
                    givenVal,
                    x1, y1,
                    targetType,
                    targetVal
                };

                const relationText = isParallel ? "parallel" : "perpendicular";
                const lineEq = isGivenVertical ? `x = ${givenVal}` : `y = ${givenVal}`;

                problemStatement.innerHTML = `
                    <p>Find the equation of a line that is <strong>${relationText}</strong> to the line:</p>
                    <p><strong class="math-display">${lineEq}</strong></p>
                    <p>and passes through <strong class="math-display">(${x1}, ${y1})</strong>.</p>
                `;
                specialLineAnswer.classList.remove('hidden');
                specialInput.focus();
            }
        }

        // --- Checking Logic ---
        function checkAnswer() {
            if (isGameOver) return;
            nextBtn.classList.remove('hidden');

            let isCorrect = false;
            let solutionHtml = '<div class="mt-4 p-4 bg-gray-50 rounded-md border border-gray-200 text-left">';
            solutionHtml += '<h4 class="font-semibold text-gray-700 mb-2">Step-by-Step Solution:</h4>';
            const q = currentQuestion;

            if (q.skillType === 0 || q.skillType === 1) { // Standard Form Problems
                const userM = parseFraction(mInput.value);
                const userB = parseFloat(bInput.value);
                
                if (isNaN(userM) || isNaN(userB)) {
                    feedbackArea.innerHTML = `<p class="incorrect-text text-center">Please enter valid numbers/fractions.</p>`;
                    return;
                }
                
                const isMCorrect = Math.abs(userM - q.m_correct) < FLOATING_POINT_TOLERANCE;
                const isBCorrect = Math.abs(userB - q.b_correct) < FLOATING_POINT_TOLERANCE;
                isCorrect = isMCorrect && isBCorrect;

                mInput.classList.toggle('correct-answer', isMCorrect);
                mInput.classList.toggle('incorrect-answer', !isMCorrect);
                bInput.classList.toggle('correct-answer', isBCorrect);
                bInput.classList.toggle('incorrect-answer', !isBCorrect);

                // --- Standard Form Conversion Steps ---
                solutionHtml += `<p class="text-gray-700 font-bold">Step 1: Find slope of given line.</p>`;
                solutionHtml += `<div class="ml-4 text-gray-600">`;
                solutionHtml += `<p>Given: ${formatStandardForm(q.A, q.B, q.C)}</p>`;
                solutionHtml += `<p>Solve for y to get slope-intercept form:</p>`;
                
                // Show standard form manipulation
                if (q.B !== 0) {
                     solutionHtml += `<p>${q.B}y = ${-q.A}x + ${q.C}</p>`;
                     solutionHtml += `<p>y = ${-q.A}/${q.B}x + ${q.C}/${q.B}</p>`;
                     solutionHtml += `<p>So, <strong class="math-display">m = ${q.m_given}</strong></p>`;
                } else {
                     solutionHtml += `<p>This is a vertical line (Special Case).</p>`;
                }
                solutionHtml += `</div>`;

                // --- Relation Step ---
                solutionHtml += `<p class="text-gray-700 font-bold mt-2">Step 2: Determine new slope.</p>`;
                if (q.skillType === 0) {
                    solutionHtml += `<p class="ml-4 text-gray-600">Since lines are <strong>parallel</strong>, slopes are equal.</p>`;
                    solutionHtml += `<p class="ml-4 text-gray-600">New Slope <strong class="math-display">m = ${q.m_correct}</strong></p>`;
                } else {
                     solutionHtml += `<p class="ml-4 text-gray-600">Since lines are <strong>perpendicular</strong>, use opposite reciprocal.</p>`;
                    solutionHtml += `<p class="ml-4 text-gray-600">Opposite of ${q.m_given} is ${-q.m_given}. Reciprocal is ${-1/q.m_given}.</p>`;
                    solutionHtml += `<p class="ml-4 text-gray-600">New Slope <strong class="math-display">m = ${q.m_correct}</strong></p>`;
                }

                // --- Point-Slope Form Steps (Requested Modification) ---
                solutionHtml += `<p class="text-gray-700 font-bold mt-2">Step 3: Use Point-Slope Form.</p>`;
                solutionHtml += `<div class="ml-4 text-gray-600">`;
                solutionHtml += `<p>Formula: <strong class="math-display">y - y_1 = m(x - x_1)</strong></p>`;
                
                // Substitution
                solutionHtml += `<p>Substitute m=${q.m_correct}, x_1=${q.x1}, y_1=${q.y1}:</p>`;
                solutionHtml += `<p><strong class="math-display">y - ${formatPointParen(q.y1)} = ${q.m_correct}(x - ${formatPointParen(q.x1)})</strong></p>`;
                
                // Distribute
                solutionHtml += `<p>Distribute the slope:</p>`;
                let distVal = q.m_correct * -q.x1;
                let distSign = distVal >= 0 ? '+' : '-';
                solutionHtml += `<p>y ${formatPointSlopeTerm(q.y1)} = ${q.m_correct}x ${distSign} ${Math.abs(distVal)}</p>`;
                
                // Solve for Y
                solutionHtml += `<p>Isolate y:</p>`;
                solutionHtml += `<p>y = ${q.m_correct}x ${distSign} ${Math.abs(distVal)} + ${q.y1}</p>`;
                
                let finalB = distVal + q.y1;
                let finalBSign = finalB >= 0 ? '+' : '-';
                solutionHtml += `<p><strong class="math-display text-blue-700">y = ${q.m_correct}x ${finalBSign} ${Math.abs(finalB)}</strong></p>`;
                solutionHtml += `</div>`;

            } else { // Special Lines
                // Normalize input
                let val = specialInput.value.toLowerCase().replace(/\s/g, '');
                let correctStr = `${q.targetType}=${q.targetVal}`;
                
                isCorrect = (val === correctStr);
                specialInput.classList.toggle('correct-answer', isCorrect);
                specialInput.classList.toggle('incorrect-answer', !isCorrect);

                // Explanation
                solutionHtml += `<p class="text-gray-600">1. Identify the given line: <strong class="math-display">${q.isGivenVertical ? 'x='+q.givenVal : 'y='+q.givenVal}</strong> is a <strong>${q.isGivenVertical ? 'Vertical' : 'Horizontal'}</strong> line.</p>`;
                
                let logicText = "";
                if (q.isParallel) {
                    logicText = `Parallel to a ${q.isGivenVertical ? 'Vertical' : 'Horizontal'} line is another <strong>${q.isGivenVertical ? 'Vertical' : 'Horizontal'}</strong> line.`;
                } else {
                    logicText = `Perpendicular to a ${q.isGivenVertical ? 'Vertical' : 'Horizontal'} line is a <strong>${q.isGivenVertical ? 'Horizontal' : 'Vertical'}</strong> line.`;
                }
                
                solutionHtml += `<p class="text-gray-600">2. ${logicText}</p>`;
                
                if (q.targetType === 'x') {
                     solutionHtml += `<p class="text-gray-600">3. Vertical lines are always <strong>x = ...</strong>. It must pass through the x-coordinate of (${q.x1}, ${q.y1}).</p>`;
                } else {
                    solutionHtml += `<p class="text-gray-600">3. Horizontal lines are always <strong>y = ...</strong>. It must pass through the y-coordinate of (${q.x1}, ${q.y1}).</p>`;
                }

                solutionHtml += `<p class="text-gray-600 mt-2">Final Answer: <strong class="math-display text-blue-700">${correctStr}</strong></p>`;
            }
            solutionHtml += '</div>';

            // --- Feedback UI ---
            let feedbackHtml = '';
            if (isCorrect) {
                feedbackHtml = `<p class="correct-text text-center mb-2">Correct!</p>`;
                checkBtn.classList.add('hidden');
                checkBtn.disabled = true;
                [mInput, bInput, specialInput].forEach(el => el.disabled = true);
                
                if (!hasLostLifeThisQuestion) {
                    score++;
                    updateStatsDisplay();
                }
            } else {
                feedbackHtml = `<p class="incorrect-text text-center mb-2">Not quite. See solution below.</p>`;
                checkBtn.classList.remove('hidden');
                checkBtn.disabled = false;

                if (!hasLostLifeThisQuestion) {
                    lives--;
                    hasLostLifeThisQuestion = true;
                    updateStatsDisplay();
                    checkGameOver();
                }
            }
            
            feedbackArea.innerHTML = feedbackHtml + solutionHtml;
        }

        function checkGameOver() {
            if (lives <= 0) {
                isGameOver = true;
                feedbackArea.innerHTML = `
                    <div class="text-center">
                        <p class="incorrect-text text-xl font-bold mb-2">Game Over!</p>
                        <p class="text-gray-700 text-lg">Your final score is: ${score}</p>
                    </div>
                `;
                checkBtn.classList.add('hidden');
                checkBtn.disabled = true;
                nextBtn.textContent = 'Restart Game';
                nextBtn.classList.remove('hidden');
                [mInput, bInput, specialInput].forEach(el => el.disabled = true);
            }
        }

        function restartGame() {
            lives = 3;
            score = 0;
            isGameOver = false;
            updateStatsDisplay();
            nextBtn.textContent = 'Next Question';
            currentSkill = -1; 
            generateQuestion();
        }

        // --- Event Listeners ---
        checkBtn.addEventListener('click', checkAnswer);
        
        nextBtn.addEventListener('click', () => {
            if (isGameOver) {
                restartGame();
            } else {
                generateQuestion();
            }
        });
        
        [mInput, bInput, specialInput].forEach(input => {
            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    if (!checkBtn.disabled) {
                        checkAnswer();
                    }
                }
            });
        });

        // Initial question on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateStatsDisplay();
            generateQuestion();
        });
    </script>
</body>
</html>
