<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Equation Practice</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for correct/incorrect feedback */
        .correct-answer {
            border: 2px solid #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .incorrect-answer {
            border: 2px solid #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
        .correct-text {
            color: #166534; /* green-800 */
            font-weight: 600;
        }
        .incorrect-text {
            color: #991b1b; /* red-800 */
            font-weight: 600;
        }
        /* Style for the math display */
        .math-display {
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.5rem; /* 24px */
            color: #1e3a8a; /* blue-800 */
            display: inline-block;
            margin: 0 0.25rem;
            font-weight: bold;
        }
        /* Style for the answer input boxes */
        .answer-input {
            width: 5rem; /* 80px */
            padding: 0.5rem;
            border: 2px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            text-align: center;
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.5rem; /* 24px */
            font-weight: bold;
        }
        .answer-input:focus {
            outline: none;
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.4);
        }
        .answer-input:disabled {
            background-color: #f3f4f6; /* gray-100 */
            color: #4b5563; /* gray-600 */
            cursor: not-allowed;
        }
    </style>
    <!-- Import Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="max-w-lg w-full">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center">Linear Equation Practice</h1>
            <p class="text-lg text-gray-600 text-center mt-2">Find the slope-intercept form `y = mx + b`</p>
            <!-- Game Stats: Lives and Score -->
            <div id="game-stats" class="text-2xl font-bold text-center mt-4 text-gray-700 flex justify-center gap-6">
                <div id="lives-counter" class="text-red-500">Lives: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div id="score-counter" class="text-blue-600">Score: 0</div>
            </div>
        </header>

        <!-- Quiz Card -->
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl">
            <!-- Question Area -->
            <div id="quiz-area" class="space-y-6">
                
                <!-- Given Problem -->
                <div class="text-center min-h-[100px] flex flex-col justify-center">
                    <p class="text-lg text-gray-600">Problem:</p>
                    <div id="problem-statement" class="my-2 text-lg text-gray-800">
                        <!-- Problem will be inserted here -->
                    </div>
                </div>
                
                <!-- Answer Input -->
                <div class="border-t border-gray-200 pt-6">
                    <p class="text-lg text-gray-600 text-center mb-4">Enter the values for `m` and `b`:</p>
                    <div class="flex items-center justify-center space-x-2 text-3xl font-bold" style="font-family: 'Times New Roman', Times, serif;">
                        <span>y =</span>
                        <input type="number" id="m-input" class="answer-input">
                        <span>x +</span>
                        <input type="number" id="b-input" class="answer-input">
                    </div>
                </div>

                <!-- Feedback Area -->
                <div id="feedback-area" class="">
                    <!-- Feedback and Solution will be injected here -->
                </div>
            </div>

            <!-- Button Area -->
            <div class="mt-6 flex flex-col sm:flex-row gap-4">
                <button id="check-btn" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors shadow-md flex-1">
                    Check Answer
                </button>
                <button id="next-btn" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-green-700 transition-colors shadow-md flex-1 hidden">
                    Next Question
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const problemStatement = document.getElementById('problem-statement');
        const mInput = document.getElementById('m-input');
        const bInput = document.getElementById('b-input');
        const feedbackArea = document.getElementById('feedback-area');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const livesCounter = document.getElementById('lives-counter');
        const scoreCounter = document.getElementById('score-counter');

        // --- State Variables ---
        let correctM = null;
        let correctB = null;
        let currentQuestion = {}; // Store question details for solution
        let currentSkill = -1; // Start at -1 to begin with skill 0
        let lives = 3;
        let score = 0;
        let isGameOver = false;
        let hasLostLifeThisQuestion = false;

        // --- Helper Functions ---
        /**
         * Generates a random integer between min and max (inclusive).
         * Can optionally exclude specific numbers.
         */
        function getRandomInt(min, max, exclude = []) {
            let num;
            do {
                num = Math.floor(Math.random() * (max - min + 1)) + min;
            } while (exclude.includes(num));
            return num;
        }

        /**
         * Formats a standard form equation string (Ax + By = C)
         * Handles positive and negative coefficients gracefully.
         */
        function formatStandardForm(A, B, C) {
            let str = '';
            // Format A
            if (A === 1) str += 'x';
            else if (A === -1) str += '-x';
            else if (A !== 0) str += `${A}x`;

            // Format B
            if (B > 0) {
                if (A !== 0) str += ' + ';
                str += (B === 1 ? 'y' : `${B}y`);
            } else if (B < 0) {
                if (A !== 0) str += ' - ';
                else str += '-';
                str += (B === -1 ? 'y' : `${Math.abs(B)}y`);
            }
            // Format C
            str += ` = ${C}`;
            return str;
        }

        /**
         * Updates the Lives and Score display
         */
        function updateStatsDisplay() {
            livesCounter.innerHTML = `Lives: ${'‚ù§Ô∏è'.repeat(lives)}${'üñ§'.repeat(3 - lives)}`;
            scoreCounter.innerHTML = `Score: ${score}`;
        }

        // --- Question Generation Logic ---
        function generateQuestion() {
            if (isGameOver) return;

            // Clear inputs and feedback
            mInput.value = '';
            bInput.value = '';
            feedbackArea.innerHTML = '';
            mInput.classList.remove('correct-answer', 'incorrect-answer');
            bInput.classList.remove('correct-answer', 'incorrect-answer');
            mInput.disabled = false;
            bInput.disabled = false;
            checkBtn.disabled = false;
            checkBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            hasLostLifeThisQuestion = false;
            
            // Cycle to the next skill (0, 1, 2)
            currentSkill = (currentSkill + 1) % 3;
            currentQuestion = { skillType: currentSkill };

            let m, b, x1, y1, x2, y2, A, B, C;

            if (currentSkill === 0) {
                // Skill 1: Given point and slope
                m = getRandomInt(-5, 5, [0]);
                b = getRandomInt(-10, 10);
                x1 = getRandomInt(-10, 10, [0]); // Avoid (0, b)
                y1 = m * x1 + b;
                
                currentQuestion = { ...currentQuestion, m, b, x1, y1 };
                correctM = m;
                correctB = b;
                
                problemStatement.innerHTML = `
                    <p>A line has a slope of <strong class="math-display">m = ${m}</strong></p>
                    <p>and passes through the point <strong class="math-display">(${x1}, ${y1})</strong>.</p>
                `;
                
                // Pre-fill and disable the 'm' input
                mInput.value = m;
                mInput.disabled = true;
                bInput.focus();

            } else if (currentSkill === 1) {
                // Skill 2: Given two points
                m = getRandomInt(-5, 5, [0]);
                b = getRandomInt(-10, 10);
                x1 = getRandomInt(-8, 8);
                y1 = m * x1 + b;
                x2 = getRandomInt(-8, 8, [x1]); // Ensure x2 is different from x1
                y2 = m * x2 + b;

                currentQuestion = { ...currentQuestion, m, b, x1, y1, x2, y2 };
                correctM = m;
                correctB = b;

                problemStatement.innerHTML = `
                    <p>A line passes through the points</p>
                    <p><strong class="math-display">(${x1}, ${y1})</strong> and <strong class="math-display">(${x2}, ${y2})</strong>.</p>
                `;
                mInput.focus();

            } else {
                // Skill 3: Given standard form
                m = getRandomInt(-5, 5, [0]);
                b = getRandomInt(-10, 10);
                // Generate B first to ensure it's not 0 or 1/-1 (to make it a problem)
                B = getRandomInt(-5, 5, [0, 1, -1]); 
                A = -m * B;
                C = b * B;
                
                // Simple GCD to reduce, e.g., -8x + 4y = 12 -> -2x + y = 3
                // For simplicity for this game, we will allow common factors.
                
                currentQuestion = { ...currentQuestion, m, b, A, B, C };
                correctM = m;
                correctB = b;

                problemStatement.innerHTML = `
                    <p>Convert the standard form equation:</p>
                    <p><strong class="math-display">${formatStandardForm(A, B, C)}</strong></p>
                    <p>to slope-intercept form.</p>
                `;
                mInput.focus();
            }
        }

        // --- Checking Logic ---
        function checkAnswer() {
            if (isGameOver) return;

            const userM = parseInt(mInput.value, 10);
            const userB = parseInt(bInput.value, 10);
            
            nextBtn.classList.remove('hidden');

            if (isNaN(userM) || isNaN(userB)) {
                feedbackArea.innerHTML = `<p class="incorrect-text text-center">Please enter a number for both 'm' and 'b'.</p>`;
                if (isNaN(userM)) mInput.classList.add('incorrect-answer');
                if (isNaN(userB)) bInput.classList.add('incorrect-answer');
                
                if (!hasLostLifeThisQuestion) {
                    lives--;
                    hasLostLifeThisQuestion = true;
                    updateStatsDisplay();
                    checkGameOver();
                }
                return;
            }
            
            const isMCorrect = (userM === correctM);
            const isBCorrect = (userB === correctB);
            
            // Apply visual feedback to inputs
            mInput.classList.toggle('correct-answer', isMCorrect);
            mInput.classList.toggle('incorrect-answer', !isMCorrect && !mInput.disabled); // Don't mark disabled input as wrong
            bInput.classList.toggle('correct-answer', isBCorrect);
            bInput.classList.toggle('incorrect-answer', !isBCorrect);

            // --- Build Solution String ---
            let solutionHtml = '<div class="mt-4 p-4 bg-gray-50 rounded-md border border-gray-200">';
            solutionHtml += '<h4 class="font-semibold text-gray-700 mb-2">Step-by-Step Solution:</h4>';
            const q = currentQuestion;

            if (q.skillType === 0) { // Point-Slope
                solutionHtml += `<p class="text-gray-600">1. Start with slope-intercept form: <strong class="math-display">y = mx + b</strong></p>`;
                solutionHtml += `<p class="text-gray-600">2. We are given the slope <strong class="math-display">m = ${q.m}</strong>. Substitute it in:</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">y = ${q.m}x + b</strong></p>`;
                solutionHtml += `<p class="text-gray-600">3. Substitute the given point <strong class="math-display">(${q.x1}, ${q.y1})</strong> for <strong class="math-display">x</strong> and <strong class="math-display">y</strong>:</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">${q.y1} = ${q.m}(${q.x1}) + b</strong></p>`;
                solutionHtml += `<p class="text-gray-600">4. Solve for <strong class="math-display">b</strong>:</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">${q.y1} = ${q.m * q.x1} + b</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">${q.y1} - ${q.m * q.x1} = b</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">b = ${q.b}</strong></p>`;

            } else if (q.skillType === 1) { // Two-Point
                solutionHtml += `<p class="text-gray-600">1. Find the slope <strong class="math-display">m</strong> using the two points <strong class="math-display">(${q.x1}, ${q.y1})</strong> and <strong class="math-display">(${q.x2}, ${q.y2})</strong>.</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">m = (y‚ÇÇ - y‚ÇÅ) / (x‚ÇÇ - x‚ÇÅ)</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">m = (${q.y2} - ${q.y1}) / (${q.x2} - ${q.x1})</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">m = ${q.y2 - q.y1} / ${q.x2 - q.x1}</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">m = ${q.m}</strong></p>`;
                solutionHtml += `<p class="text-gray-600">2. Now use one point (e.g., <strong class="math-display">(${q.x1}, ${q.y1})</strong>) and the slope to find <strong class="math-display">b</strong>.</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">y = mx + b</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">${q.y1} = ${q.m}(${q.x1}) + b</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">b = ${q.b}</strong> (after solving)</p>`;

            } else { // Standard Form
                solutionHtml += `<p class="text-gray-600">1. Start with the given equation:</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">${formatStandardForm(q.A, q.B, q.C)}</strong></p>`;
                solutionHtml += `<p class="text-gray-600">2. Isolate the <strong class="math-display">y</strong> term. Subtract <strong class="math-display">${q.A}x</strong> from both sides:</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">${formatStandardForm(0, q.B, q.C)} = -${q.A}x + ${q.C}</strong></p>`;
                solutionHtml += `<p class="text-gray-600">3. Divide all terms by <strong class="math-display">${q.B}</strong> to solve for <strong class="math-display">y</strong>:</p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">y = (-${q.A} / ${q.B})x + (${q.C} / ${q.B})</strong></p>`;
                solutionHtml += `<p class="text-gray-600 text-center my-1"><strong class="math-display">y = ${-q.A / q.B}x + ${q.C / q.B}</strong></p>`;
                solutionHtml += `<p class="text-gray-600">4. So, <strong class="math-display">m = ${q.m}</strong> and <strong class="math-display">b = ${q.b}</strong>.</p>`;
            }
            solutionHtml += `<p class="text-gray-600 text-center mt-2 font-bold">Final Equation: <strong class="math-display text-green-700">y = ${q.m}x + ${q.b}</strong></p>`;
            solutionHtml += '</div>';
            
            // --- Prepend Feedback and manage buttons ---
            let feedbackHtml = '';
            if (isMCorrect && isBCorrect) {
                feedbackHtml = `<p class="correct-text text-center mb-2">Correct! Great job.</p>`;
                checkBtn.classList.add('hidden');
                checkBtn.disabled = true;
                mInput.disabled = true;
                bInput.disabled = true;

                if (!hasLostLifeThisQuestion) {
                    score++;
                    updateStatsDisplay();
                }

            } else {
                let errorMsg = 'Not quite. Review the solution below.';
                if (!isMCorrect && isBCorrect) {
                    errorMsg = 'The y-intercept `b` is correct, but the slope `m` is not. Check your calculations!';
                } else if (isMCorrect && !isBCorrect) {
                    errorMsg = 'The slope `m` is correct, but the y-intercept `b` is not. Try substituting a point again!';
                }
                feedbackHtml = `<p class="incorrect-text text-center mb-2">${errorMsg}</p>`;
                checkBtn.classList.remove('hidden');
                checkBtn.disabled = false;

                if (!hasLostLifeThisQuestion) {
                    lives--;
                    hasLostLifeThisQuestion = true;
                    updateStatsDisplay();
                    checkGameOver();
                }
            }
            
            feedbackArea.innerHTML = feedbackHtml + solutionHtml;
        }

        /**
         * Checks if the game is over (lives <= 0)
         */
        function checkGameOver() {
            if (lives <= 0) {
                isGameOver = true;
                // Clear existing feedback and show game over
                feedbackArea.innerHTML = `
                    <p class="incorrect-text text-center text-xl font-bold mb-2">Game Over!</p>
                    <p class="text-gray-700 text-center text-lg">Your final score is: ${score}</p>
                `;
                checkBtn.classList.add('hidden');
                checkBtn.disabled = true;
                nextBtn.textContent = 'Restart Game';
                nextBtn.classList.remove('hidden');
                mInput.disabled = true;
                bInput.disabled = true;
            }
        }

        /**
         * Restarts the game from scratch
         */
        function restartGame() {
            lives = 3;
            score = 0;
            isGameOver = false;
            updateStatsDisplay();
            nextBtn.textContent = 'Next Question';
            currentSkill = -1; // Reset to start at skill 0 on next generate
            generateQuestion();
        }

        // --- Event Listeners ---
        checkBtn.addEventListener('click', checkAnswer);
        
        nextBtn.addEventListener('click', () => {
            if (isGameOver) {
                restartGame();
            } else {
                generateQuestion();
            }
        });
        
        // Allow pressing Enter to check answer
        mInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                if (!checkBtn.disabled) {
                    checkAnswer();
                }
            }
        });
        bInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                if (!checkBtn.disabled) {
                    checkAnswer();
                }
            }
        });

        // Initial question on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateStatsDisplay(); // Show initial stats
            generateQuestion();
        });
    </script>
</body>
</html>
