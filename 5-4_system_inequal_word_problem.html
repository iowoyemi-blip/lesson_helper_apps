<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systems of Inequalities: Real World</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for feedback */
        .correct-text { color: #166534; font-weight: 600; }
        .incorrect-text { color: #991b1b; font-weight: 600; }
        
        /* Graph Container */
        .graph-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            aspect-ratio: 1 / 1;
            border: 1px solid #ccc;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .graph-container svg {
            display: block;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .grid-line { stroke: #e5e7eb; stroke-width: 1; }
        .axis-line { stroke: #4b5563; stroke-width: 2; }
        .axis-label { font-family: 'Inter', sans-serif; font-size: 10px; fill: #4b5563; }

        /* Inequality Graphing Styles */
        .line-solid { stroke-width: 2; }
        .line-dashed { stroke-width: 2; stroke-dasharray: 5,5; }
        
        .shade-region { fill-opacity: 0.2; }
        
        /* Color coding for inequalities */
        .ineq1-stroke { stroke: #2563eb; } /* Blue */
        .ineq1-fill { fill: #2563eb; }
        
        .ineq2-stroke { stroke: #db2777; } /* Pink */
        .ineq2-fill { fill: #db2777; }

        /* Input Styles */
        .math-input {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            padding: 0.25rem 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            width: 140px;
            text-align: center;
        }
        .symbol-select {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            padding: 0.25rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            background-color: #f9fafb;
        }
    </style>
    <!-- Import Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="max-w-4xl w-full">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center">Systems of Inequalities</h1>
            <p class="text-lg text-gray-600 text-center mt-2">Real World Context Challenge</p>
            <!-- Game Stats -->
            <div id="game-stats" class="text-2xl font-bold text-center mt-4 text-gray-700 flex justify-center gap-6">
                <div id="lives-counter" class="text-red-500">Lives: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div id="score-counter" class="text-blue-600">Score: 0</div>
            </div>
        </header>

        <!-- Main Card -->
        <div class="bg-white p-6 rounded-lg shadow-xl">
            
            <!-- Word Problem -->
            <div class="mb-6 p-4 bg-blue-50 border border-blue-100 rounded-lg">
                <p id="word-problem-text" class="text-lg text-gray-800 font-serif leading-relaxed">
                    <!-- Problem text inserted here -->
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Controls Column -->
                <div class="space-y-8">
                    
                    <!-- Inequality 1 Controls -->
                    <div class="p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 id="ineq1-title" class="text-blue-700 font-bold mb-2">Inequality 1</h3>
                        <div class="flex flex-wrap items-center gap-2 mb-3">
                            <span class="font-serif text-xl">y</span>
                            <select id="ineq1-symbol" class="symbol-select">
                                <option value="le">‚â§</option>
                                <option value="ge">‚â•</option>
                                <option value="lt">&lt;</option>
                                <option value="gt">&gt;</option>
                            </select>
                            <input type="text" id="ineq1-rhs" class="math-input" placeholder="-x + 20">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="plotInequality(1)" class="bg-white border border-gray-300 px-3 py-1 rounded hover:bg-gray-100 text-sm">Plot Line</button>
                            <button onclick="toggleShade(1)" class="bg-white border border-gray-300 px-3 py-1 rounded hover:bg-gray-100 text-sm">Switch Shade</button>
                        </div>
                    </div>

                    <!-- Inequality 2 Controls -->
                    <div class="p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 id="ineq2-title" class="text-pink-700 font-bold mb-2">Inequality 2</h3>
                        <div class="flex flex-wrap items-center gap-2 mb-3">
                            <span class="font-serif text-xl">y</span>
                            <select id="ineq2-symbol" class="symbol-select">
                                <option value="le">‚â§</option>
                                <option value="ge">‚â•</option>
                                <option value="lt">&lt;</option>
                                <option value="gt">&gt;</option>
                            </select>
                            <input type="text" id="ineq2-rhs" class="math-input" placeholder="-0.5x + 10">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="plotInequality(2)" class="bg-white border border-gray-300 px-3 py-1 rounded hover:bg-gray-100 text-sm">Plot Line</button>
                            <button onclick="toggleShade(2)" class="bg-white border border-gray-300 px-3 py-1 rounded hover:bg-gray-100 text-sm">Switch Shade</button>
                        </div>
                    </div>

                    <!-- Solution Check -->
                    <div class="p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 class="text-gray-700 font-bold mb-2">Identify a Solution</h3>
                        <p class="text-sm text-gray-600 mb-2">Based on your graph, identify one possible valid integer solution.</p>
                        <div class="flex flex-wrap items-center gap-2">
                            <span id="var-x-label" class="font-semibold">x</span>: <input type="number" id="sol-x" class="math-input w-20">
                            <span id="var-y-label" class="font-semibold">y</span>: <input type="number" id="sol-y" class="math-input w-20">
                        </div>
                    </div>

                </div>

                <!-- Graph Column -->
                <div>
                    <div class="graph-container">
                        <svg id="main-svg" viewBox="0 0 500 500">
                            <!-- Graph content -->
                        </svg>
                    </div>
                    <div class="text-center mt-2 text-sm text-gray-500">
                        X-Axis: <span id="axis-x-name">X</span> | Y-Axis: <span id="axis-y-name">Y</span>
                    </div>
                </div>

            </div>

            <!-- Feedback & Main Buttons -->
            <div class="mt-8 text-center">
                <div id="feedback-area" class="h-8 mb-4 font-bold"></div>
                
                <div class="flex justify-center gap-4">
                    <button id="check-btn" class="w-full md:w-1/3 bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors shadow-md">
                        Check All
                    </button>
                    <button id="next-btn" class="w-full md:w-1/3 bg-green-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-green-700 transition-colors shadow-md hidden">
                        Next Problem
                    </button>
                    <button id="restart-btn" class="w-full md:w-1/3 bg-red-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-red-700 transition-colors shadow-md hidden">
                        Restart Game
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- State ---
        let lives = 3;
        let score = 0;
        let currentProblem = {};
        let lastProblemCategory = -1; // To prevent repeating same problem structure
        
        // User state for graphing
        let userIneq1 = { plotted: false, m: 0, b: 0, shadeAbove: true, symbol: 'le' };
        let userIneq2 = { plotted: false, m: 0, b: 0, shadeAbove: true, symbol: 'le' };

        // --- Constants ---
        const SVG_SIZE = 500;
        const MAX_VAL = 60; // Increased range for larger numbers (Furniture/Food Truck)
        const GRID_STEP = 5; 
        const GRID_PIXELS = SVG_SIZE / MAX_VAL; 

        // --- DOM Elements ---
        const svg = document.getElementById('main-svg');
        const wordProblemText = document.getElementById('word-problem-text');
        const feedbackArea = document.getElementById('feedback-area');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        
        // --- Helper Functions ---
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function updateStats() {
            document.getElementById('lives-counter').textContent = `Lives: ${'‚ù§Ô∏è'.repeat(lives)}${'üñ§'.repeat(3 - lives)}`;
            document.getElementById('score-counter').textContent = `Score: ${score}`;
        }

        function toPixelX(val) { return val * GRID_PIXELS; }
        function toPixelY(val) { return SVG_SIZE - (val * GRID_PIXELS); } // Invert Y

        // --- Drawing ---
        function drawGrid() {
            svg.innerHTML = '';
            
            // Draw Grid
            for(let i=0; i<=MAX_VAL; i+=GRID_STEP) {
                let pos = i * GRID_PIXELS;
                // Vertical
                let vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                vLine.setAttribute('x1', pos); vLine.setAttribute('y1', 0);
                vLine.setAttribute('x2', pos); vLine.setAttribute('y2', SVG_SIZE);
                vLine.classList.add('grid-line');
                svg.appendChild(vLine);
                
                // Horizontal (from bottom up)
                let hPos = SVG_SIZE - pos;
                let hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                hLine.setAttribute('x1', 0); hLine.setAttribute('y1', hPos);
                hLine.setAttribute('x2', SVG_SIZE); hLine.setAttribute('y2', hPos);
                hLine.classList.add('grid-line');
                svg.appendChild(hLine);
            }

            // Axes
            let xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', 0); xAxis.setAttribute('y1', SVG_SIZE);
            xAxis.setAttribute('x2', SVG_SIZE); xAxis.setAttribute('y2', SVG_SIZE);
            xAxis.classList.add('axis-line');
            svg.appendChild(xAxis);

            let yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', 0); yAxis.setAttribute('y1', 0);
            yAxis.setAttribute('x2', 0); yAxis.setAttribute('y2', SVG_SIZE);
            yAxis.classList.add('axis-line');
            svg.appendChild(yAxis);

            // Labels
            let labelStep = 10; // Label every 10 units
            for(let i=0; i<=MAX_VAL; i+=labelStep) { 
                if(i===0) continue;
                // X label
                let xTxt = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                xTxt.setAttribute('x', toPixelX(i));
                xTxt.setAttribute('y', SVG_SIZE - 5);
                xTxt.setAttribute('text-anchor', 'middle');
                xTxt.classList.add('axis-label');
                xTxt.textContent = i;
                svg.appendChild(xTxt);

                // Y label
                let yTxt = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                yTxt.setAttribute('x', 5);
                yTxt.setAttribute('y', toPixelY(i) + 4);
                yTxt.setAttribute('text-anchor', 'start');
                yTxt.classList.add('axis-label');
                yTxt.textContent = i;
                svg.appendChild(yTxt);
            }
        }

        function drawInequality(ineqObj, idSuffix, colorClassStroke, colorClassFill) {
            const oldLine = document.getElementById('line-' + idSuffix);
            const oldShade = document.getElementById('shade-' + idSuffix);
            if(oldLine) oldLine.remove();
            if(oldShade) oldShade.remove();

            if(!ineqObj.plotted) return;

            let x1 = 0;
            let y1 = ineqObj.b;
            let x2 = MAX_VAL;
            let y2 = ineqObj.m * MAX_VAL + ineqObj.b;

            let p1 = `${toPixelX(x1)},${toPixelY(y1)}`;
            let p2 = `${toPixelX(x2)},${toPixelY(y2)}`;
            
            let corners = "";
            if(ineqObj.shadeAbove) {
                corners = `${toPixelX(MAX_VAL)},0 0,0`; 
            } else {
                corners = `${toPixelX(MAX_VAL)},${SVG_SIZE} 0,${SVG_SIZE}`;
            }
            
            let polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            polygon.setAttribute('id', 'shade-' + idSuffix);
            polygon.setAttribute('points', `${p1} ${p2} ${corners}`);
            polygon.classList.add('shade-region', colorClassFill);
            svg.prepend(polygon);

            let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('id', 'line-' + idSuffix);
            line.setAttribute('x1', toPixelX(x1));
            line.setAttribute('y1', toPixelY(y1));
            line.setAttribute('x2', toPixelX(x2));
            line.setAttribute('y2', toPixelY(y2));
            
            let isSolid = (ineqObj.symbol === 'le' || ineqObj.symbol === 'ge');
            line.classList.add(isSolid ? 'line-solid' : 'line-dashed', colorClassStroke);
            svg.appendChild(line); 
        }

        // --- Problem Logic: Categories ---

        // Category 1: Income/Revenue/Production (Value >= Target, Qty <= Limit)
        // Mav (Jobs), Furniture (Sales), Food Truck, Tickets
        function generateCategory1() {
            const scenarios = [
                { name: "Mav (Jobs)", x: "Lifeguard Hours", y: "Landscaping Hours", xVal: 15, yVal: 10, xUnit: "hrs", yUnit: "hrs", valUnit: "$" },
                { name: "Furniture", x: "Tables", y: "Chairs", xVal: 350, yVal: 100, xUnit: "", yUnit: "", valUnit: "$" },
                { name: "Food Truck", x: "Tacos", y: "Burritos", xVal: 4.50, yVal: 8.50, xUnit: "", yUnit: "", valUnit: "$" },
                { name: "Theater", x: "Student Tix", y: "Adult Tix", xVal: 5, yVal: 10, xUnit: "", yUnit: "", valUnit: "$" }
            ];
            
            const sc = scenarios[getRandomInt(0, scenarios.length - 1)];
            
            // Pick a feasible solution
            const solX = getRandomInt(5, 20);
            const solY = getRandomInt(5, 20);
            
            // Constraint 1: Quantity <= Max
            const totalQty = solX + solY;
            const maxQty = totalQty + getRandomInt(2, 10);
            // Ineq 1: x + y <= maxQty  => y <= -x + maxQty
            const ineq1 = { m: -1, b: maxQty, symbol: 'le', shadeAbove: false };

            // Constraint 2: Value >= Min
            const totalVal = solX * sc.xVal + solY * sc.yVal;
            const minVal = Math.floor(totalVal * 0.8); // Ensure solution works
            
            // Ineq 2: Ax + By >= Min => y >= -(A/B)x + Min/B
            const m2 = -(sc.xVal / sc.yVal);
            const b2 = minVal / sc.yVal;
            const ineq2 = { m: m2, b: b2, symbol: 'ge', shadeAbove: true };

            const text = `${sc.name} involves <b>x ${sc.x}</b> ($${sc.xVal}) and <b>y ${sc.y}</b> ($${sc.yVal}). There is a limit of <b>${maxQty}</b> total items/hours. The goal is to generate at least <b>$${minVal}</b> in value.`;

            return {
                text,
                xLabel: sc.x,
                yLabel: sc.y,
                labels: ["Total Quantity Constraint", "Minimum Value Constraint"],
                ineq1, ineq2
            };
        }

        // Category 2: Budget/Shopping (Cost <= Budget, Qty >= Need)
        // Bakery, Clothing, Supplies
        function generateCategory2() {
            const scenarios = [
                { name: "Bakery", x: "Cupcakes", y: "Brownies", xVal: 4, yVal: 2.50 },
                { name: "Clothing", x: "Shirts", y: "Pants", xVal: 15, yVal: 25 },
                { name: "Supplies", x: "Binders", y: "Notebooks", xVal: 5, yVal: 3 }
            ];
            
            const sc = scenarios[getRandomInt(0, scenarios.length - 1)];
            
            const solX = getRandomInt(5, 15);
            const solY = getRandomInt(5, 15);
            
            // Constraint 1: Quantity >= Min (Needs)
            const totalQty = solX + solY;
            const minQty = Math.max(2, totalQty - getRandomInt(2, 5));
            // Ineq 1: x + y >= minQty => y >= -x + minQty
            const ineq1 = { m: -1, b: minQty, symbol: 'ge', shadeAbove: true };

            // Constraint 2: Cost <= Max (Budget)
            const totalCost = solX * sc.xVal + solY * sc.yVal;
            const maxBudget = Math.ceil(totalCost * 1.2);
            // Ineq 2: Ax + By <= Max => y <= -(A/B)x + Max/B
            const m2 = -(sc.xVal / sc.yVal);
            const b2 = maxBudget / sc.yVal;
            const ineq2 = { m: m2, b: b2, symbol: 'le', shadeAbove: false };

            const text = `At the ${sc.name}, <b>x ${sc.x}</b> cost $${sc.xVal} and <b>y ${sc.y}</b> cost $${sc.yVal}. You need at least <b>${minQty}</b> items total, but have a budget of only <b>$${maxBudget}</b>.`;

            return {
                text,
                xLabel: sc.x,
                yLabel: sc.y,
                labels: ["Minimum Quantity Needed", "Maximum Budget Constraint"],
                ineq1, ineq2
            };
        }

        // Category 3: Strict Limits (Qty <= Max, Weight/Vol <= Max)
        // Elevator, Truck, Shelf
        function generateCategory3() {
            const scenarios = [
                { name: "Elevator", x: "Adults", y: "Children", xVal: 150, yVal: 75, unit: "lbs" },
                { name: "Truck Loading", x: "Heavy Boxes", y: "Light Boxes", xVal: 50, yVal: 20, unit: "kg" },
                { name: "Bookshelf", x: "Hardcovers", y: "Paperbacks", xVal: 2, yVal: 1, unit: "inches" }
            ];
            
            const sc = scenarios[getRandomInt(0, scenarios.length - 1)];
            
            const solX = getRandomInt(2, 10);
            const solY = getRandomInt(5, 20);
            
            // Constraint 1: Count <= Max
            const totalCount = solX + solY;
            const maxCount = totalCount + getRandomInt(1, 5);
            // Ineq 1: x + y <= maxCount
            const ineq1 = { m: -1, b: maxCount, symbol: 'le', shadeAbove: false };

            // Constraint 2: Capacity <= Max
            const totalCap = solX * sc.xVal + solY * sc.yVal;
            const maxCap = Math.ceil(totalCap * 1.1);
            // Ineq 2: Ax + By <= Max
            const m2 = -(sc.xVal / sc.yVal);
            const b2 = maxCap / sc.yVal;
            const ineq2 = { m: m2, b: b2, symbol: 'le', shadeAbove: false };

            const text = `For the ${sc.name}, <b>x ${sc.x}</b> are ${sc.xVal}${sc.unit} and <b>y ${sc.y}</b> are ${sc.yVal}${sc.unit}. The space holds at most <b>${maxCount}</b> items and can support no more than <b>${maxCap} ${sc.unit}</b>.`;

            return {
                text,
                xLabel: sc.x,
                yLabel: sc.y,
                labels: ["Max Item Count", "Max Capacity Constraint"],
                ineq1, ineq2
            };
        }

        function startNewProblem() {
            // Reset User State
            userIneq1 = { plotted: false, m: 0, b: 0, shadeAbove: true, symbol: 'le' };
            userIneq2 = { plotted: false, m: 0, b: 0, shadeAbove: true, symbol: 'le' };
            
            // Clear UI
            document.getElementById('ineq1-rhs').value = '';
            document.getElementById('ineq2-rhs').value = '';
            document.getElementById('sol-x').value = '';
            document.getElementById('sol-y').value = '';
            feedbackArea.textContent = '';
            
            checkBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');
            
            drawGrid(); 

            // Pick a new category distinct from the last
            let cat = getRandomInt(1, 3);
            while (cat === lastProblemCategory) {
                cat = getRandomInt(1, 3);
            }
            lastProblemCategory = cat;

            if (cat === 1) currentProblem = generateCategory1();
            else if (cat === 2) currentProblem = generateCategory2();
            else currentProblem = generateCategory3();

            // Update UI Labels
            wordProblemText.innerHTML = currentProblem.text;
            document.getElementById('var-x-label').textContent = currentProblem.xLabel;
            document.getElementById('var-y-label').textContent = currentProblem.yLabel;
            document.getElementById('axis-x-name').textContent = currentProblem.xLabel;
            document.getElementById('axis-y-name').textContent = currentProblem.yLabel;
            
            // Update Card Titles
            document.getElementById('ineq1-title').textContent = `Inequality 1 (${currentProblem.labels[0]})`;
            document.getElementById('ineq2-title').textContent = `Inequality 2 (${currentProblem.labels[1]})`;
        }

        // --- Graphing Actions ---

        function parseLinear(str) {
            let s = str.toLowerCase().replace(/\s/g, '');
            let m = 0;
            let b = 0;
            
            if(s.includes('x')) {
                let parts = s.split('x');
                let mStr = parts[0];
                let bStr = parts[1];
                
                if(mStr === '' || mStr === '+') m = 1;
                else if(mStr === '-') m = -1;
                else m = parseFloat(mStr);
                
                if(bStr) b = parseFloat(bStr);
            } else {
                b = parseFloat(s);
            }
            return { m: isNaN(m)?0:m, b: isNaN(b)?0:b };
        }

        window.plotInequality = function(num) {
            const rhsInput = document.getElementById(`ineq${num}-rhs`);
            const symbolInput = document.getElementById(`ineq${num}-symbol`);
            
            const parsed = parseLinear(rhsInput.value);
            
            const target = (num === 1) ? userIneq1 : userIneq2;
            target.m = parsed.m;
            target.b = parsed.b;
            target.symbol = symbolInput.value;
            target.plotted = true;
            
            const colorStroke = (num===1) ? 'ineq1-stroke' : 'ineq2-stroke';
            const colorFill = (num===1) ? 'ineq1-fill' : 'ineq2-fill';
            
            drawInequality(target, num, colorStroke, colorFill);
        };

        window.toggleShade = function(num) {
            const target = (num === 1) ? userIneq1 : userIneq2;
            if(!target.plotted) return;
            target.shadeAbove = !target.shadeAbove;
            const colorStroke = (num===1) ? 'ineq1-stroke' : 'ineq2-stroke';
            const colorFill = (num===1) ? 'ineq1-fill' : 'ineq2-fill';
            drawInequality(target, num, colorStroke, colorFill);
        };

        // --- Check Logic ---

        function checkGame() {
            function checkSingle(user, correct) {
                const mOk = Math.abs(user.m - correct.m) < 0.05; // Little more tolerance for messy decimals
                const bOk = Math.abs(user.b - correct.b) < 0.5;
                
                const userDir = (user.symbol === 'le' || user.symbol === 'lt') ? 'less' : 'greater';
                const corrDir = (correct.symbol === 'le' || correct.symbol === 'lt') ? 'less' : 'greater';
                const symOk = userDir === corrDir;
                const shadeOk = user.shadeAbove === correct.shadeAbove;
                
                return mOk && bOk && symOk && shadeOk;
            }

            const ineq1Ok = checkSingle(userIneq1, currentProblem.ineq1);
            const ineq2Ok = checkSingle(userIneq2, currentProblem.ineq2);

            const solX = parseFloat(document.getElementById('sol-x').value);
            const solY = parseFloat(document.getElementById('sol-y').value);
            
            const checkPt = (x, y, ineq) => {
                const rhs = ineq.m * x + ineq.b;
                if(ineq.symbol === 'le') return y <= rhs + 0.01;
                if(ineq.symbol === 'lt') return y < rhs;
                if(ineq.symbol === 'ge') return y >= rhs - 0.01;
                if(ineq.symbol === 'gt') return y > rhs;
                return false;
            };

            let pointOk = false;
            if(!isNaN(solX) && !isNaN(solY) && solX >= 0 && solY >= 0) {
                if(Number.isInteger(solX) && Number.isInteger(solY)) {
                    if(checkPt(solX, solY, currentProblem.ineq1) && checkPt(solX, solY, currentProblem.ineq2)) {
                        pointOk = true;
                    }
                }
            }

            if(ineq1Ok && ineq2Ok && pointOk) {
                score++;
                updateStats();
                feedbackArea.className = "h-8 mb-4 font-bold correct-text";
                feedbackArea.textContent = "Excellent! Graph and solution are correct.";
                checkBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
            } else {
                lives--;
                updateStats();
                feedbackArea.className = "h-8 mb-4 font-bold incorrect-text";
                
                let msg = "Not quite. ";
                if(!ineq1Ok) msg += "Check Inequality 1 equation or shading. ";
                else if(!ineq2Ok) msg += "Check Inequality 2 equation or shading. ";
                else if(!pointOk) msg += "Your solution point isn't in the shaded region (or isn't valid).";
                
                feedbackArea.textContent = msg;

                if(lives <= 0) {
                    checkBtn.classList.add('hidden');
                    restartBtn.classList.remove('hidden');
                    feedbackArea.textContent = `Game Over! Lines were y=${currentProblem.ineq1.m.toFixed(2)}x+${currentProblem.ineq1.b.toFixed(1)} and y=${currentProblem.ineq2.m.toFixed(2)}x+${currentProblem.ineq2.b.toFixed(1)}`;
                }
            }
        }

        // Events
        checkBtn.addEventListener('click', checkGame);
        nextBtn.addEventListener('click', startNewProblem);
        restartBtn.addEventListener('click', () => {
            lives = 3; score = 0; updateStats();
            startNewProblem();
            restartBtn.classList.add('hidden');
        });

        // Init
        updateStats();
        startNewProblem();

    </script>
</body>
</html>