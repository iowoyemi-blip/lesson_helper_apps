<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finding Slope Practice</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for correct/incorrect feedback */
        .correct-answer {
            border: 2px solid #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .incorrect-answer {
            border: 2px solid #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
        .correct-text {
            color: #166534; /* green-800 */
            font-weight: 600;
        }
        .incorrect-text {
            color: #991b1b; /* red-800 */
            font-weight: 600;
        }
        
        /* Graph Container */
        .graph-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            position: relative;
            aspect-ratio: 1 / 1;
            border: 1px solid #ccc;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .graph-container svg {
            display: block;
            width: 100%;
            height: 100%;
        }
        .grid-line { stroke: #e5e7eb; stroke-width: 1; }
        .axis-line { stroke: #4b5563; stroke-width: 2; }
        .graph-line { stroke: #2563eb; stroke-width: 3; }
        .graph-point { fill: #2563eb; stroke: white; stroke-width: 2; r: 5; }
        .axis-label { font-size: 10px; fill: #6b7280; }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
            font-size: 1.1rem;
        }
        .data-table th {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            font-weight: 600;
        }
        .data-table td {
            border: 1px solid #d1d5db;
            padding: 0.5rem;
        }

        /* Input Styles */
        .profile-input {
            width: 100%;
            padding: 0.75rem;
            font-size: 1.1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            text-align: center;
            margin-top: 0.5rem;
        }
        .problem-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 300px;
        }
        .problem-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #374151;
            margin-bottom: 1rem;
            width: 100%;
            text-align: left;
            border-bottom: 2px solid #f3f4f6;
            padding-bottom: 0.5rem;
        }

        /* Keyboard */
        .symbol-keyboard {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .symbol-btn {
            font-family: 'Menlo', 'Courier New', monospace;
            font-size: 1.25rem;
            font-weight: bold;
            min-width: 40px;
            height: 40px;
            padding: 0 1rem;
            border: 1px solid #d1d5db;
            background-color: #f9fafb;
            border-radius: 0.375rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .symbol-btn:hover { background-color: #f3f4f6; }
        .btn-wide { min-width: 100px; font-size: 1rem; }
    </style>
    <!-- Import Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="max-w-6xl w-full">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center">Slopes from Different Representations</h1>
            <p class="text-lg text-gray-600 text-center mt-2">Find the slope (m) for each representation</p>
            <!-- Game Stats -->
            <div id="game-stats" class="text-2xl font-bold text-center mt-4 text-gray-700 flex justify-center gap-6">
                <div id="lives-counter" class="text-red-500">Lives: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div id="score-counter" class="text-blue-600">Score: 0</div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="bg-white p-6 rounded-lg shadow-xl">
            
            <!-- Keyboard -->
            <div class="symbol-keyboard">
                <button class="symbol-btn" data-symbol="/">/</button>
                <button class="symbol-btn" data-symbol="-">-</button>
                <button class="symbol-btn btn-wide" data-symbol="Undefined">Undefined</button>
            </div>

            <!-- Problems Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Type A: Points -->
                <div class="problem-card">
                    <div class="problem-title">a. Through Points</div>
                    <div id="points-display" class="text-2xl font-serif text-center my-auto">
                        <!-- (x1, y1) and (x2, y2) -->
                    </div>
                    <div class="w-full">
                        <label class="text-sm font-semibold text-gray-500">m =</label>
                        <input type="text" id="input-points" class="profile-input" placeholder="Enter slope">
                    </div>
                </div>

                <!-- Type B: Graph -->
                <div class="problem-card">
                    <div class="problem-title">b. The Graph</div>
                    <div class="graph-container">
                        <svg id="svg-graph" viewBox="0 0 300 300"></svg>
                    </div>
                    <div class="w-full">
                        <label class="text-sm font-semibold text-gray-500">m =</label>
                        <input type="text" id="input-graph" class="profile-input" placeholder="Enter slope">
                    </div>
                </div>

                <!-- Type C: Table -->
                <div class="problem-card">
                    <div class="problem-title">c. Table of Values</div>
                    <div class="w-full flex-grow flex items-center justify-center">
                        <table class="data-table" id="table-display">
                            <!-- Rows inserted here -->
                        </table>
                    </div>
                    <div class="w-full">
                        <label class="text-sm font-semibold text-gray-500">m =</label>
                        <input type="text" id="input-table" class="profile-input" placeholder="Enter slope">
                    </div>
                </div>

            </div>

            <!-- Feedback & Buttons -->
            <div class="mt-8 text-center">
                <div id="feedback-area" class="h-8 mb-4"></div>
                
                <div class="flex justify-center gap-4">
                    <button id="check-btn" class="w-full md:w-1/3 bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors shadow-md">
                        Check Answer
                    </button>
                    <button id="next-btn" class="w-full md:w-1/3 bg-green-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-green-700 transition-colors shadow-md hidden">
                        Next Set
                    </button>
                    <button id="restart-btn" class="w-full md:w-1/3 bg-red-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-red-700 transition-colors shadow-md hidden">
                        Restart Game
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- State ---
        let lives = 3;
        let score = 0;
        let isGameOver = false;
        let currentSet = {}; // Holds data for current 3 problems
        let lastFocusedInput = document.getElementById('input-points');

        // --- DOM ---
        const livesCounter = document.getElementById('lives-counter');
        const scoreCounter = document.getElementById('score-counter');
        const feedbackArea = document.getElementById('feedback-area');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        
        const inputs = {
            points: document.getElementById('input-points'),
            graph: document.getElementById('input-graph'),
            table: document.getElementById('input-table')
        };
        const allInputs = Object.values(inputs);

        const pointsDisplay = document.getElementById('points-display');
        const graphSvg = document.getElementById('svg-graph');
        const tableDisplay = document.getElementById('table-display');

        // --- Constants ---
        const SVG_SIZE = 300;
        const GRID_RANGE = 5; // -5 to 5
        const NUM_GRIDS = GRID_RANGE * 2; // 10 boxes
        const GRID_SIZE = SVG_SIZE / NUM_GRIDS; // 30px
        const MID = SVG_SIZE / 2;

        // --- Helpers ---
        function getRandomInt(min, max, exclude = []) {
            let num;
            do {
                min = Math.ceil(min);
                max = Math.floor(max);
                num = Math.floor(Math.random() * (max - min + 1)) + min;
            } while (exclude.includes(num));
            return num;
        }

        function updateStats() {
            livesCounter.innerHTML = `Lives: ${'‚ù§Ô∏è'.repeat(lives)}${'üñ§'.repeat(3 - lives)}`;
            scoreCounter.innerHTML = `Score: ${score}`;
        }

        function toPixel(val) { return MID + (val * GRID_SIZE); }
        function toPixelY(val) { return MID - (val * GRID_SIZE); } // Inverted Y

        // --- Slope Logic ---
        
        // Generates a slope (m) and y-intercept (b)
        // Returns m as value (Infinity for undefined) and points
        function generateLineData(allowUndefined = true) {
            const type = Math.random();
            
            if (allowUndefined && type < 0.15) {
                // Undefined Slope (Vertical)
                const x = getRandomInt(-4, 4);
                return { m: Infinity, b: null, xConst: x, isVertical: true };
            } else if (type < 0.3) {
                // Zero Slope (Horizontal)
                const y = getRandomInt(-4, 4);
                return { m: 0, b: y, isVertical: false };
            } else {
                // Standard Slope
                // Ensure we pick points that fit on a small grid
                let run = getRandomInt(1, 3);
                let rise = getRandomInt(-3, 3, [0]);
                let m = rise / run;
                
                // Pick a starting point that keeps the line somewhat centered
                let startX = getRandomInt(-2, 2);
                let startY = getRandomInt(-2, 2);
                
                // Calculate b
                // y = mx + b => b = y - mx
                let b = startY - (m * startX);
                
                return { m: m, b: b, isVertical: false };
            }
        }

        // --- Generators ---

        function generatePointsProblem() {
            // Generate integer coordinates
            const x1 = getRandomInt(-10, 10);
            const x2 = getRandomInt(-10, 10);
            const y1 = getRandomInt(-10, 10);
            const y2 = getRandomInt(-10, 10);
            
            // Calculate slope
            let m;
            if (x1 === x2) m = Infinity;
            else m = (y2 - y1) / (x2 - x1);

            const display = `(${x1}, ${y1}) and (${x2}, ${y2})`;
            return { m, display };
        }

        function generateGraphProblem() {
            // Use the helper, strict bounds [-5, 5]
            let line = generateLineData();
            
            // Find two integer points on the grid [-5, 5]
            let points = [];
            if (line.isVertical) {
                points.push({x: line.xConst, y: -3});
                points.push({x: line.xConst, y: 3});
            } else {
                // Scan x from -5 to 5 to find integer y
                for (let x = -5; x <= 5; x++) {
                    let y = line.m * x + line.b;
                    // Check floating point tolerance for integer
                    if (Math.abs(y - Math.round(y)) < 0.001) {
                        if (Math.round(y) >= -5 && Math.round(y) <= 5) {
                            points.push({x: x, y: Math.round(y)});
                        }
                    }
                }
                // If we don't have enough points, try again (recursive)
                if (points.length < 2) return generateGraphProblem();
                
                // Pick 2 points far apart if possible
                if(points.length > 2) {
                    points = [points[0], points[points.length-1]];
                }
            }

            // Render
            renderGraph(line, points);
            
            return { m: line.m };
        }

        function renderGraph(line, points) {
            graphSvg.innerHTML = '';
            
            // Grid
            for (let i = 0; i <= NUM_GRIDS; i++) {
                let pos = i * GRID_SIZE;
                let hLine = `<line x1="0" y1="${pos}" x2="${SVG_SIZE}" y2="${pos}" class="grid-line" />`;
                let vLine = `<line x1="${pos}" y1="0" x2="${pos}" y2="${SVG_SIZE}" class="grid-line" />`;
                graphSvg.innerHTML += hLine + vLine;
            }
            // Axes
            graphSvg.innerHTML += `<line x1="0" y1="${MID}" x2="${SVG_SIZE}" y2="${MID}" class="axis-line" />`;
            graphSvg.innerHTML += `<line x1="${MID}" y1="0" x2="${MID}" y2="${SVG_SIZE}" class="axis-line" />`;

            // Line
            let x1, y1, x2, y2;
            if (line.isVertical) {
                x1 = toPixel(line.xConst); y1 = 0;
                x2 = toPixel(line.xConst); y2 = SVG_SIZE;
            } else {
                x1 = 0; y1 = toPixelY(line.m * -GRID_RANGE + line.b);
                x2 = SVG_SIZE; y2 = toPixelY(line.m * GRID_RANGE + line.b);
            }
            graphSvg.innerHTML += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" class="graph-line" />`;

            // Points
            points.forEach(p => {
                graphSvg.innerHTML += `<circle cx="${toPixel(p.x)}" cy="${toPixelY(p.y)}" class="graph-point" />`;
            });
        }

        function generateTableProblem() {
            // Linear pattern table
            let mNum = getRandomInt(-5, 5, [0]);
            let mDen = getRandomInt(1, 3);
            if(Math.random() < 0.2) mDen = 1; // Integer slope often
            
            let m = mNum / mDen;
            let b = getRandomInt(-10, 10);
            
            // Generate rows. Ensure Integers if possible, but for table, consistency is key
            let startX = getRandomInt(0, 5);
            let stepX = mDen; // Step by denominator to ensure integer Ys if m is fraction
            
            let rows = [];
            for(let i=0; i<4; i++) {
                let x = startX + (i * stepX);
                let y = m * x + b;
                rows.push({x, y});
            }

            // Render Table
            let html = `<thead><tr><th>x</th><th>y</th></tr></thead><tbody>`;
            rows.forEach(r => {
                html += `<tr><td>${r.x}</td><td>${r.y}</td></tr>`;
            });
            html += `</tbody>`;
            tableDisplay.innerHTML = html;

            return { m: m };
        }

        // --- Main Loop ---

        function startNewSet() {
            if(isGameOver) return;

            // Reset Inputs
            allInputs.forEach(i => {
                i.value = '';
                i.disabled = false;
                i.classList.remove('correct-answer', 'incorrect-answer');
            });
            feedbackArea.textContent = '';
            checkBtn.classList.remove('hidden');
            nextBtn.classList.add('hidden');

            // Generate Problems
            const pProb = generatePointsProblem();
            pointsDisplay.textContent = pProb.display;

            const gProb = generateGraphProblem();
            const tProb = generateTableProblem();

            currentSet = {
                points: pProb,
                graph: gProb,
                table: tProb
            };
        }

        // --- Checking ---

        function normalizeInput(str) {
            let s = str.toLowerCase().replace(/\s/g, '');
            if (s === 'undefined') return Infinity;
            if (s.includes('/')) {
                const parts = s.split('/');
                if (parts.length === 2) {
                    const num = parseFloat(parts[0]);
                    const den = parseFloat(parts[1]);
                    if (den === 0) return Infinity;
                    return num / den;
                }
            }
            return parseFloat(s);
        }

        function checkProblem(input, correctM) {
            const userVal = normalizeInput(input.value);
            
            // Handle Infinity
            if (correctM === Infinity) {
                if (userVal === Infinity) {
                    input.classList.add('correct-answer');
                    input.classList.remove('incorrect-answer');
                    return true;
                }
                input.classList.add('incorrect-answer');
                return false;
            }

            // Handle Numbers
            if (Math.abs(userVal - correctM) < 0.001) {
                input.classList.add('correct-answer');
                input.classList.remove('incorrect-answer');
                return true;
            }
            input.classList.add('incorrect-answer');
            return false;
        }

        function checkAll() {
            const pOk = checkProblem(inputs.points, currentSet.points.m);
            const gOk = checkProblem(inputs.graph, currentSet.graph.m);
            const tOk = checkProblem(inputs.table, currentSet.table.m);

            if (pOk && gOk && tOk) {
                score++;
                updateStats();
                feedbackArea.innerHTML = `<p class="correct-text">Perfect! All slopes correct.</p>`;
                allInputs.forEach(i => i.disabled = true);
                checkBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
            } else {
                lives--;
                updateStats();
                if (lives <= 0) {
                    isGameOver = true;
                    feedbackArea.innerHTML = `<p class="incorrect-text font-bold text-xl">Game Over! Final Score: ${score}</p>`;
                    allInputs.forEach(i => i.disabled = true);
                    checkBtn.classList.add('hidden');
                    restartBtn.classList.remove('hidden');
                    
                    // Show answers
                    const fmt = (m) => m === Infinity ? "Undefined" : m; 
                    inputs.points.value = fmt(currentSet.points.m);
                    inputs.graph.value = fmt(currentSet.graph.m);
                    inputs.table.value = fmt(currentSet.table.m);
                } else {
                    feedbackArea.innerHTML = `<p class="incorrect-text">Check your slopes! Remember rise over run.</p>`;
                }
            }
        }

        function restartGame() {
            lives = 3;
            score = 0;
            isGameOver = false;
            updateStats();
            restartBtn.classList.add('hidden');
            startNewSet();
        }

        // --- Events ---
        
        checkBtn.addEventListener('click', checkAll);
        nextBtn.addEventListener('click', startNewSet);
        restartBtn.addEventListener('click', restartGame);

        // Keyboard logic
        allInputs.forEach(i => {
            i.addEventListener('focus', () => lastFocusedInput = i);
        });
        document.querySelector('.symbol-keyboard').addEventListener('click', (e) => {
            if (e.target.classList.contains('symbol-btn')) {
                const sym = e.target.dataset.symbol;
                if (lastFocusedInput) {
                    // For undefined, just replace current value
                    if (sym === 'Undefined') lastFocusedInput.value = 'Undefined';
                    else lastFocusedInput.value += sym;
                    lastFocusedInput.focus();
                }
            }
        });

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            updateStats();
            startNewSet();
        });

    </script>
</body>
</html>