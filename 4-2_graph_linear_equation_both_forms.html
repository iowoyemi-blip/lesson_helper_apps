<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphing Linear Equations</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        .correct-text {
            color: #166534; /* green-800 */
            font-weight: 600;
        }
        .incorrect-text {
            color: #991b1b; /* red-800 */
            font-weight: 600;
        }
        /* Style for the graph */
        .graph-container {
            width: 100%;
            max-width: 480px; /* 480/16 = 30px per grid */
            margin: 0 auto;
            position: relative;
            aspect-ratio: 1 / 1; /* Keep it square */
            border: 1px solid #ccc;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: crosshair;
        }
        .graph-container svg {
            display: block;
            width: 100%;
            height: 100%;
        }
        .grid-line {
            stroke: #e5e7eb; /* Light gray */
            stroke-width: 1;
        }
        .axis-line {
            stroke: #4b5563; /* Darker gray */
            stroke-width: 2;
        }
        .axis-label {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            fill: #4b5563;
        }
        /* Student-drawn elements */
        .student-point {
            fill: #2563eb; /* blue-600 */
            stroke: #ffffff;
            stroke-width: 2;
        }
        .student-line {
            stroke: #2563eb; /* blue-600 */
            stroke-width: 3;
            stroke-dasharray: 5 5; /* Dashed line */
        }
        .correct-line {
            stroke: #16a34a; /* green-600 */
            stroke-width: 4;
        }
    </style>
    <!-- Import Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="max-w-xl w-full">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center">Graphing Linear Equations</h1>
            <p class="text-lg text-gray-600 text-center mt-2">Graph the line by clicking two points</p>
            <!-- Game Stats: Lives and Score -->
            <div id="game-stats" class="text-2xl font-bold text-center mt-4 text-gray-700 flex justify-center gap-6">
                <div id="lives-counter" class="text-red-500">Lives: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div id="score-counter" class="text-blue-600">Score: 0</div>
            </div>
        </header>

        <!-- Quiz Card -->
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl">
            <!-- Equation to Graph -->
            <div class="text-center">
                <p class="text-lg text-gray-600">Graph the following equation:</p>
                <p id="equation-display" class="text-4xl font-bold text-blue-600 my-3" style="font-family: 'Times New Roman', Times, serif;">y = 2x + 1</p>
                <p id="instruction-text" class="text-lg text-gray-700 font-semibold h-6">1. Click the y-intercept.</p>
            </div>

            <!-- Graph Area -->
            <div class="my-4">
                <div class="graph-container" id="graph-container">
                    <svg id="svg-grid" viewBox="0 0 480 480"></svg>
                </div>
            </div>
            
            <!-- Feedback Area -->
            <div id="feedback-area" class="text-center h-6 mb-4">
                <!-- Feedback will be injected here -->
            </div>

            <!-- Button Area -->
            <div class="grid grid-cols-2 gap-4">
                <button id="reset-btn" class="w-full bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-gray-600 transition-colors shadow-md hidden">
                    Reset Points
                </button>
                <button id="check-btn" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors shadow-md hidden col-span-2">
                    Check Answer
                </button>
                <button id="next-btn" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-green-700 transition-colors shadow-md hidden col-span-2">
                    Next Question
                </button>
                <button id="restart-btn" class="w-full bg-red-600 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-red-700 transition-colors shadow-md hidden col-span-2">
                    Restart Game
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const graphContainer = document.getElementById('graph-container');
        const svgGrid = document.getElementById('svg-grid');
        const equationDisplay = document.getElementById('equation-display');
        const instructionText = document.getElementById('instruction-text');
        const feedbackArea = document.getElementById('feedback-area');
        const checkBtn = document.getElementById('check-btn');
        const resetBtn = document.getElementById('reset-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const livesCounter = document.getElementById('lives-counter');
        const scoreCounter = document.getElementById('score-counter');

        // --- Game State ---
        let lives = 3;
        let score = 0;
        let isGameOver = false;
        let currentEquation = {};
        let clickedPoints = []; // Stores {x, y} cartesian coordinates
        let nextEquationType = 'slopeIntercept'; // 'slopeIntercept' or 'standardForm'

        // --- Graphing Constants ---
        const SVG_SIZE = 480;
        const GRID_RANGE = 8; // -8 to 8
        const NUM_GRIDS = GRID_RANGE * 2; // 16
        const GRID_SIZE = SVG_SIZE / NUM_GRIDS; // 30px
        const MID = SVG_SIZE / 2;

        // --- Helper: Get Random Integer ---
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // --- Helper: Update Stats Display ---
        function updateStatsDisplay() {
            livesCounter.innerHTML = `Lives: ${'‚ù§Ô∏è'.repeat(lives)}${'üñ§'.repeat(3 - lives)}`;
            scoreCounter.innerHTML = `Score: ${score}`;
        }

        // --- Coordinate Conversion ---
        function toPixelCoords(cx, cy) {
            return {
                x: MID + (cx * GRID_SIZE),
                y: MID - (cy * GRID_SIZE) // SVG y-axis is inverted
            };
        }

        function toCartesianCoords(px, py) {
            return {
                x: Math.round((px - MID) / GRID_SIZE),
                y: Math.round((MID - py) / GRID_SIZE) // SVG y-axis is inverted
            };
        }

        // --- SVG Drawing ---
        function createSvgGrid() {
            svgGrid.innerHTML = ''; // Clear previous grid

            // Draw grid lines
            for (let i = 0; i <= NUM_GRIDS; i++) {
                let pos = i * GRID_SIZE;
                // Horizontal
                let hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                hLine.setAttribute('x1', 0); hLine.setAttribute('y1', pos);
                hLine.setAttribute('x2', SVG_SIZE); hLine.setAttribute('y2', pos);
                hLine.classList.add('grid-line');
                svgGrid.appendChild(hLine);
                // Vertical
                let vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                vLine.setAttribute('x1', pos); vLine.setAttribute('y1', 0);
                vLine.setAttribute('x2', pos); vLine.setAttribute('y2', SVG_SIZE);
                vLine.classList.add('grid-line');
                svgGrid.appendChild(vLine);
            }

            // Draw axes
            let xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', 0); xAxis.setAttribute('y1', MID);
            xAxis.setAttribute('x2', SVG_SIZE); xAxis.setAttribute('y2', MID);
            xAxis.classList.add('axis-line');
            svgGrid.appendChild(xAxis);

            let yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', MID); yAxis.setAttribute('y1', 0);
            yAxis.setAttribute('x2', MID); yAxis.setAttribute('y2', SVG_SIZE);
            yAxis.classList.add('axis-line');
            svgGrid.appendChild(yAxis);

            // Add axis labels
            function addLabel(x, y, text, align = 'middle', baseline = 'central') {
                let label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', y);
                label.setAttribute('text-anchor', align);
                label.setAttribute('dominant-baseline', baseline);
                label.textContent = text;
                label.classList.add('axis-label');
                svgGrid.appendChild(label);
            }

            for(let i = 1; i <= GRID_RANGE; i++) {
                if (i % 2 === 0) { // Label every 2 units
                    addLabel(MID + (i * GRID_SIZE), MID + 12, i); // +x
                    addLabel(MID - (i * GRID_SIZE), MID + 12, -i); // -x
                    addLabel(MID - 12, MID - (i * GRID_SIZE), i, 'end'); // +y
                    addLabel(MID - 12, MID + (i * GRID_SIZE), -i, 'end'); // -y
                }
            }
        }

        function drawPoint(cx, cy, id) {
            const p = toPixelCoords(cx, cy);
            let circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('id', id);
            circle.setAttribute('cx', p.x);
            circle.setAttribute('cy', p.y);
            circle.setAttribute('r', 5);
            circle.classList.add('student-point');
            svgGrid.appendChild(circle);
        }

        /**
         * Draws a line based on slope and intercept, extending to the graph edges.
         * @param {number} m - The slope of the line.
         * @param {number} b - The y-intercept of the line.
         * @param {string} id - The DOM ID for the line element.
         * @param {string} lineClass - The CSS class for styling the line.
         */
        function drawFullLine(m, b, id, lineClass) {
            // Calculate y-values at the edges of the graph (x = -GRID_RANGE and x = +GRID_RANGE)
            const x1 = -GRID_RANGE;
            const y1 = m * x1 + b;
            
            const x2 = GRID_RANGE;
            const y2 = m * x2 + b;

            // Convert these edge points to pixel coordinates
            const px1 = toPixelCoords(x1, y1);
            const px2 = toPixelCoords(x2, y2);
            
            let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('id', id);
            line.setAttribute('x1', px1.x);
            line.setAttribute('y1', px1.y);
            line.setAttribute('x2', px2.x);
            line.setAttribute('y2', px2.y);
            line.classList.add(lineClass);
            svgGrid.appendChild(line);
        }

        /**
         * Draws a vertical line at a specific x-coordinate.
         * @param {number} x - The x-coordinate of the vertical line.
         * @param {string} id - The DOM ID for the line element.
         * @param {string} lineClass - The CSS class for styling the line.
         */
        function drawVerticalLine(x, id, lineClass) {
            const px1 = toPixelCoords(x, -GRID_RANGE);
            const px2 = toPixelCoords(x, GRID_RANGE);

            let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('id', id);
            line.setAttribute('x1', px1.x);
            line.setAttribute('y1', px1.y);
            line.setAttribute('x2', px2.x);
            line.setAttribute('y2', px2.y);
            line.classList.add(lineClass);
            svgGrid.appendChild(line);
        }

        function clearStudentDrawings() {
            const p1 = document.getElementById('point-1');
            const p2 = document.getElementById('point-2');
            const line = document.getElementById('student-line');
            const answerLine = document.getElementById('answer-line');
            if (p1) p1.remove();
            if (p2) p2.remove();
            if (line) line.remove();
            if (answerLine) answerLine.remove();
        }

        // --- Problem Generation ---
        function generateProblem() {
            if (isGameOver) return;

            let m, b;
            do {
                m = getRandomInt(-3, 3);
            } while (m === 0); // No horizontal lines for this task
            
            b = getRandomInt(-5, 5);
            currentEquation = { m, b }; // Store the solution

            // Format equation string based on type
            if (nextEquationType === 'slopeIntercept') {
                let mStr = (m === 1) ? "x" : (m === -1) ? "-x" : `${m}x`;
                let bStr = (b > 0) ? `+ ${b}` : (b < 0) ? `- ${Math.abs(b)}` : "";
                equationDisplay.textContent = `y = ${mStr} ${bStr}`;
                nextEquationType = 'standardForm'; // Set up for next time
            } else {
                // Generate Ax + By = C form
                // We use y = mx + b  =>  -mx + y = b
                let A, B, C;
                if (m > 0) {
                    // m is positive, e.g., y = 2x + 3  =>  -2x + y = 3
                    // Let's make A positive: 2x - y = -3
                    A = m;
                    B = -1;
                    C = -b;
                } else {
                    // m is negative, e.g., y = -2x + 3  =>  2x + y = 3
                    A = -m;
                    B = 1;
                    C = b;
                }

                let A_str = (A === 1) ? "x" : `${A}x`;
                let B_str = (B === 1) ? "+ y" : (B === -1) ? "- y" : (B > 0) ? `+ ${B}y` : `- ${Math.abs(B)}y`;
                
                equationDisplay.textContent = `${A_str} ${B_str} = ${C}`;
                nextEquationType = 'slopeIntercept'; // Set up for next time
            }

            resetPoints(); // Clear board and reset state
            nextBtn.classList.add('hidden');
            feedbackArea.innerHTML = '';
            instructionText.textContent = '1. Click the y-intercept.';
        }

        // --- Game Logic ---
        function handleGraphClick(event) {
            const rect = svgGrid.getBoundingClientRect();
            const px = event.clientX - rect.left;
            const py = event.clientY - rect.top;
            
            const p = toCartesianCoords(px, py);
            
            if (clickedPoints.length === 0) {
                // First click (y-intercept)
                clickedPoints.push(p);
                drawPoint(p.x, p.y, 'point-1');
                instructionText.textContent = '2. Use the slope to find a second point.';
                resetBtn.classList.remove('hidden');
            } else if (clickedPoints.length === 1) {
                // Second click (slope point)
                if (p.x === clickedPoints[0].x && p.y === clickedPoints[0].y) return; // Ignore same point
                
                clickedPoints.push(p);
                drawPoint(p.x, p.y, 'point-2');

                // Calculate slope and intercept from student's two points
                const p1_stu = clickedPoints[0];
                const p2_stu = clickedPoints[1];

                if (p1_stu.x === p2_stu.x) {
                    // Student clicked a vertical line
                    drawVerticalLine(p1_stu.x, 'student-line', 'student-line');
                } else {
                    // Student clicked a slanted line
                    const m_stu = (p2_stu.y - p1_stu.y) / (p2_stu.x - p1_stu.x);
                    const b_stu = p1_stu.y - m_stu * p1_stu.x;
                    drawFullLine(m_stu, b_stu, 'student-line', 'student-line');
                }
                
                instructionText.textContent = "Check your work!";
                graphContainer.style.pointerEvents = 'none'; // Disable more clicks
                checkBtn.classList.remove('hidden');
                checkBtn.classList.remove('col-span-2');
                resetBtn.classList.remove('hidden');
            }
        }

        function resetPoints() {
            clickedPoints = [];
            clearStudentDrawings();
            graphContainer.style.pointerEvents = 'auto'; // Re-enable clicks
            instructionText.textContent = '1. Click the y-intercept.';
            feedbackArea.innerHTML = '';
            checkBtn.classList.add('hidden');
            checkBtn.classList.add('col-span-2');
            resetBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
        }

        function checkAnswer() {
            const p1 = clickedPoints[0];
            const p2 = clickedPoints[1];
            const { m, b } = currentEquation;

            const isInterceptCorrect = (p1.x === 0 && p1.y === b);
            // Check if p2 is *any* valid point on the line (and not the same as p1)
            const isSlopePointCorrect = (p2.y === (m * p2.x + b));
            
            checkBtn.classList.add('hidden');
            resetBtn.classList.add('hidden');

            if (isInterceptCorrect && isSlopePointCorrect) {
                // CORRECT
                score++;
                updateStatsDisplay();
                feedbackArea.innerHTML = `<p class="correct-text">Correct! y = ${m}x + ${b}</p>`;
                // Remove student line and draw solid correct line
                document.getElementById('student-line').remove();
                drawFullLine(m, b, 'answer-line', 'correct-line');
                nextBtn.classList.remove('hidden');
            } else {
                // INCORRECT
                lives--;
                updateStatsDisplay();
                let errorMsg = '';
                if (!isInterceptCorrect) {
                    errorMsg = "Your first point isn't the correct y-intercept. Try again.";
                } else {
                    errorMsg = "Your y-intercept is correct, but your second point is not on the line. Try again.";
                }
                
                if (lives <= 0) {
                    // GAME OVER
                    isGameOver = true;
                    feedbackArea.innerHTML = `<p class="incorrect-text">Game Over! Final Score: ${score}</p>`;
                    // Show the correct answer
                    drawFullLine(m, b, 'answer-line', 'correct-line');
                    restartBtn.classList.remove('hidden');
                } else {
                    // Try again
                    feedbackArea.innerHTML = `<p class="incorrect-text">${errorMsg}</p>`;
                    // Force reset
                    resetBtn.classList.remove('hidden');
                    resetBtn.classList.add('col-span-2'); // Make reset button full width
                }
            }
        }

        function handleRestart() {
            lives = 3;
            score = 0;
            isGameOver = false;
            updateStatsDisplay();
            restartBtn.classList.add('hidden');
            generateProblem();
        }

        // --- Event Listeners ---
        svgGrid.addEventListener('click', handleGraphClick);
        checkBtn.addEventListener('click', checkAnswer);
        resetBtn.addEventListener('click', () => {
             resetPoints();
             resetBtn.classList.remove('col-span-2'); // Revert to half width
        });
        nextBtn.addEventListener('click', generateProblem);
        restartBtn.addEventListener('click', handleRestart);

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            createSvgGrid();
            generateProblem();
            updateStatsDisplay();
        });
    </script>
</body>
</html>